<pre class="canvas-renderer__preview"><link class="canvas-renderer__style-set" href="css/vs.css" rel="stylesheet"><code class="canvas-renderer__code-container python hljs"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> (Flask,
                   make_response,
                                     redirect,
                                                       render_template,
                                                                         abort, url_for, session)
                                                                        
                                                                        <span class="hljs-keyword">from</span> flask_script <span class="hljs-keyword">import</span> Manager
                                                                        <span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap
                                                                        <span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy
                                                                        <span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate, MigrateCommand
                                                                        
                                                                        
                                                                        
                                                                        <span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> (StringField,
                                                                                   IntegerField, 
                                                                                             SubmitField)
                                                                                            <span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired, Length
                                                                                            
                                                                                            <span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> Form
                                                                                            
                                                                                            <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict
                                                                                            
                                                                                            
                                                                                            app = Flask(__name__, template_folder=<span class="hljs-string">"templates"</span>)
                                                                                            manager = Manager(app)
                                                                                            bootstrap = Bootstrap(app)
                                                                                            db = SQLAlchemy(app)
                                                                                            migrate = Migrate(app=app, db=db)
                                                                                            manager.add_command(<span class="hljs-string">'db'</span>, MigrateCommand)
                                                                                            
                                                                                            
                                                                                            
                                                                                            
                                                                                            <span class="hljs-keyword">import</span> os 
                                                                                            app.config[<span class="hljs-string">"SECRET_KEY"</span>] = <span class="hljs-string">"uezfhuizehfuhzefhzefzie347687U"</span>
                                                                                            basedir = os.path.abspath(os.path.dirname(__file__))
                                                                                            app.config[<span class="hljs-string">"SQLALCHEMY_DATABASE_URI"</span>] = <span class="hljs-string">'sqlite:///'</span> + os.path.join(basedir, <span class="hljs-string">'mesdonnees.sqlite'</span>)
                                                                                            
                                                                                            
                                                                                            <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NouveauForm</span><span class="hljs-params">(Form)</span>:</span>
                                                                                              name = StringField(<span class="hljs-string">"Ton nom !!!"</span>, validators=[DataRequired()])
                                                                                                submit_button = SubmitField(<span class="hljs-string">"Envoi"</span>)
                                                                                                
                                                                                                
                                                                                                <span class="hljs-comment"># 1 user peut avoir plusieurs posts</span>
                                                                                                <span class="hljs-comment"># 1 post ne vient qu'un utilisateur</span>
                                                                                                
                                                                                                
                                                                                                
                                                                                                <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(db.Model)</span>:</span>
                                                                                                  __tablename__ = <span class="hljs-string">"posts"</span>
                                                                                                    id_ = db.Column(db.Integer, primary_key=<span class="hljs-keyword">True</span>)
                                                                                                      name = db.Column(db.String(<span class="hljs-number">64</span>), unique=<span class="hljs-keyword">True</span>, nullable=<span class="hljs-keyword">False</span>)
                                                                                                        user_id = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">"users.id_"</span>))
                                                                                                          
                                                                                                            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
                                                                                                                <span class="hljs-keyword">return</span> <span class="hljs-string">"Le Post num :  {} , nom : {}"</span>.format(self.id_, self.name)
                                                                                                                
                                                                                                                <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(db.Model)</span>:</span>
                                                                                                                  __tablename__ = <span class="hljs-string">"users"</span>
                                                                                                                    id_ = db.Column(db.Integer, primary_key=<span class="hljs-keyword">True</span>)
                                                                                                                      username = db.Column(db.String(<span class="hljs-number">30</span>), unique=<span class="hljs-keyword">True</span>, nullable=<span class="hljs-keyword">False</span>)
                                                                                                                        <span class="hljs-comment">#email = db.Column(db.String(100), unique=True)</span>
                                                                                                                          <span class="hljs-comment">#age = db.Column(db.String(100))</span>
                                                                                                                            posts = db.relationship(<span class="hljs-string">"Post"</span>, backref=<span class="hljs-string">"user"</span>)
                                                                                                                            
                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
                                                                                                                                  <span class="hljs-keyword">return</span> <span class="hljs-string">"User n°{} name: {}"</span>.format(self.id_, self.username)
                                                                                                                                  
                                                                                                                                  
                                                                                                                                  
                                                                                                                                  <span class="hljs-decorator">@app.route('/')</span>
                                                                                                                                  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bonjour</span><span class="hljs-params">()</span>:</span>
                                                                                                                                      <span class="hljs-keyword">return</span> <span class="hljs-string">"test"</span>
                                                                                                                                      
                                                                                                                                      <span class="hljs-decorator">@app.route('/login/')</span>
                                                                                                                                      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">myfonction</span><span class="hljs-params">()</span>:</span>
                                                                                                                                      
                                                                                                                                        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"autre_page.html"</span>, 
                                                                                                                                            var1=session.get(<span class="hljs-string">"name"</span>))
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            <span class="hljs-decorator">@app.route('/users/')</span>
                                                                                                                                            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_users</span><span class="hljs-params">()</span>:</span>
                                                                                                                                              <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'listing.html'</span>, liste=User.query.all())
                                                                                                                                              
                                                                                                                                              <span class="hljs-decorator">@app.route('/posts/')</span>
                                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_posts</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'listing.html'</span>, liste = Post.query.all())
                                                                                                                                                
                                                                                                                                                <span class="hljs-decorator">@app.route('/test/&lt;name&gt;', methods=['GET', 'POST'])</span>
                                                                                                                                                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">(name)</span>:</span>
                                                                                                                                                  <span class="hljs-comment"># if request.method == "GET":</span>
                                                                                                                                                    <span class="hljs-comment">#   pass</span>
                                                                                                                                                      <span class="hljs-comment"># if request.method == "PUT":</span>
                                                                                                                                                        <span class="hljs-comment">#   pass</span>
                                                                                                                                                          <span class="hljs-comment"># if request.method == "POST"</span>
                                                                                                                                                            <span class="hljs-comment">#   pass</span>
                                                                                                                                                              myform = NouveauForm()
                                                                                                                                                                <span class="hljs-keyword">if</span> myform.validate_on_submit():
                                                                                                                                                                    session[<span class="hljs-string">'name'</span>] = myform.name.data
                                                                                                                                                                    
                                                                                                                                                                        <span class="hljs-comment"># je filtre dans ma db en recherche de user</span>
                                                                                                                                                                            user_retrieved = User.query.filter_by(username=myform.name.data).first()
                                                                                                                                                                                print(user_retrieved)
                                                                                                                                                                                    <span class="hljs-keyword">if</span> user_retrieved <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
                                                                                                                                                                                          <span class="hljs-comment"># if n'existe pas</span>
                                                                                                                                                                                                <span class="hljs-comment"># je crée une nouvelle instance user</span>
                                                                                                                                                                                                      user = User(username = myform.name.data)
                                                                                                                                                                                                            db.session.add(user)
                                                                                                                                                                                                                  db.session.commit()
                                                                                                                                                                                                                        <span class="hljs-comment"># pour garder en mémoire</span>
                                                                                                                                                                                                                              session[<span class="hljs-string">"connu"</span>] = <span class="hljs-string">"Vous êtes inconnu, on vous ajoute !"</span>
                                                                                                                                                                                                                                  <span class="hljs-keyword">else</span>:
                                                                                                                                                                                                                                        session[<span class="hljs-string">"connu"</span>] = <span class="hljs-string">"Vous êtes connu de la bdd !"</span>
                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                myform.name.data = <span class="hljs-string">''</span>
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'test'</span>, name=session.get(<span class="hljs-string">'name'</span>)))
                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                      contenu_html = <span class="hljs-string">"&lt;h1&gt; Salut toi ;) &lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                          dico = OrderedDict({
                                                                                                                                                                                                                                                              <span class="hljs-string">"tâche1"</span>: <span class="hljs-string">"Faire la vaisselle"</span>,
                                                                                                                                                                                                                                                                  <span class="hljs-string">"tâche2"</span>: <span class="hljs-string">"Faire le ménage"</span>,
                                                                                                                                                                                                                                                                      <span class="hljs-string">"tâche3"</span>: <span class="hljs-string">"écouter Monsieur Bertin"</span>
                                                                                                                                                                                                                                                                          })
                                                                                                                                                                                                                                                                            <span class="hljs-comment"># presentation rendered </span>
                                                                                                                                                                                                                                                                              <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>, var1=name, var2=contenu_html, dico=dico, form=myform, connu=session.get(<span class="hljs-string">"connu"</span>))
                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                              <span class="hljs-decorator">@app.route("/voiciunredirect/")</span>
                                                                                                                                                                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unefonction</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                  <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">"myfonction"</span>)
                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                  <span class="hljs-decorator">@app.route('/user/&lt;name&gt;')</span>
                                                                                                                                                                                                                                                                                  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trouve</span><span class="hljs-params">(name)</span>:</span>
                                                                                                                                                                                                                                                                                      <span class="hljs-comment"># -----</span>
                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;h1&gt;Hello &lt;i&gt;"</span> + name + <span class="hljs-string">"&lt;/i&gt;&lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                          <span class="hljs-comment">#@app.route('/&lt;path:nompath&gt;')</span>
                                                                                                                                                                                                                                                                                          <span class="hljs-comment"># def test2(nompath):</span>
                                                                                                                                                                                                                                                                                          <span class="hljs-comment">#  return "&lt;h1&gt;Hello&lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                          <span class="hljs-decorator">@app.route('/&lt;path:nompath&gt;')</span>
                                                                                                                                                                                                                                                                                          <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error_404</span><span class="hljs-params">(nompath)</span>:</span>
                                                                                                                                                                                                                                                                                            abort(<span class="hljs-number">404</span>, <span class="hljs-string">"The page {} is not found"</span>.format(nompath))
                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                            <span class="hljs-decorator">@app.errorhandler(404)</span>
                                                                                                                                                                                                                                                                                            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_not_found</span><span class="hljs-params">(e)</span>:</span>
                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'404.html'</span>, error_message=e), <span class="hljs-number">404</span>
                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
                                                                                                                                                                                                                                                                                                  manager.run()
                                                                                                                                                                                                                                                                                                  <span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> (Flask,
                                                                                                                                                                                                                                                                                                                     make_response,
                                                                                                                                                                                                                                                                                                                                       redirect,
                                                                                                                                                                                                                                                                                                                                                         render_template,
                                                                                                                                                                                                                                                                                                                                                                           abort, url_for, session)
                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">from</span> flask_script <span class="hljs-keyword">import</span> Manager
                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap
                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy
                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">from</span> flask_migrate <span class="hljs-keyword">import</span> Migrate, MigrateCommand
                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> (StringField,
                                                                                                                                                                                                                                                                                                                                                                                     IntegerField, 
                                                                                                                                                                                                                                                                                                                                                                                               SubmitField)
                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired, Length
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> Form
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              app = Flask(__name__, template_folder=<span class="hljs-string">"templates"</span>)
                                                                                                                                                                                                                                                                                                                                                                                              manager = Manager(app)
                                                                                                                                                                                                                                                                                                                                                                                              bootstrap = Bootstrap(app)
                                                                                                                                                                                                                                                                                                                                                                                              db = SQLAlchemy(app)
                                                                                                                                                                                                                                                                                                                                                                                              migrate = Migrate(app=app, db=db)
                                                                                                                                                                                                                                                                                                                                                                                              manager.add_command(<span class="hljs-string">'db'</span>, MigrateCommand)
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-keyword">import</span> os 
                                                                                                                                                                                                                                                                                                                                                                                              app.config[<span class="hljs-string">"SECRET_KEY"</span>] = <span class="hljs-string">"uezfhuizehfuhzefhzefzie347687U"</span>
                                                                                                                                                                                                                                                                                                                                                                                              basedir = os.path.abspath(os.path.dirname(__file__))
                                                                                                                                                                                                                                                                                                                                                                                              app.config[<span class="hljs-string">"SQLALCHEMY_DATABASE_URI"</span>] = <span class="hljs-string">'sqlite:///'</span> + os.path.join(basedir, <span class="hljs-string">'mesdonnees.sqlite'</span>)
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NouveauForm</span><span class="hljs-params">(Form)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                name = StringField(<span class="hljs-string">"Ton nom !!!"</span>, validators=[DataRequired()])
                                                                                                                                                                                                                                                                                                                                                                                                  submit_button = SubmitField(<span class="hljs-string">"Envoi"</span>)
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-comment"># 1 user peut avoir plusieurs posts</span>
                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-comment"># 1 post ne vient qu'un utilisateur</span>
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Post</span><span class="hljs-params">(db.Model)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                    __tablename__ = <span class="hljs-string">"posts"</span>
                                                                                                                                                                                                                                                                                                                                                                                                      id_ = db.Column(db.Integer, primary_key=<span class="hljs-keyword">True</span>)
                                                                                                                                                                                                                                                                                                                                                                                                        name = db.Column(db.String(<span class="hljs-number">64</span>), unique=<span class="hljs-keyword">True</span>, nullable=<span class="hljs-keyword">False</span>)
                                                                                                                                                                                                                                                                                                                                                                                                          user_id = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">"users.id_"</span>))
                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-keyword">return</span> <span class="hljs-string">"Le Post num :  {} , nom : {}"</span>.format(self.id_, self.name)
                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(db.Model)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                    __tablename__ = <span class="hljs-string">"users"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                      id_ = db.Column(db.Integer, primary_key=<span class="hljs-keyword">True</span>)
                                                                                                                                                                                                                                                                                                                                                                                                                        username = db.Column(db.String(<span class="hljs-number">30</span>), unique=<span class="hljs-keyword">True</span>, nullable=<span class="hljs-keyword">False</span>)
                                                                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-comment">#email = db.Column(db.String(100), unique=True)</span>
                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment">#age = db.Column(db.String(100))</span>
                                                                                                                                                                                                                                                                                                                                                                                                                              posts = db.relationship(<span class="hljs-string">"Post"</span>, backref=<span class="hljs-string">"user"</span>)
                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-keyword">return</span> <span class="hljs-string">"User n°{} name: {}"</span>.format(self.id_, self.username)
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-decorator">@app.route('/')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bonjour</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-keyword">return</span> <span class="hljs-string">"test"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-decorator">@app.route('/login/')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">myfonction</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"autre_page.html"</span>, 
                                                                                                                                                                                                                                                                                                                                                                                                                                              var1=session.get(<span class="hljs-string">"name"</span>))
                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-decorator">@app.route('/users/')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_users</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'listing.html'</span>, liste=User.query.all())
                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-decorator">@app.route('/posts/')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all_posts</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'listing.html'</span>, liste = Post.query.all())
                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-decorator">@app.route('/test/&lt;name&gt;', methods=['GET', 'POST'])</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">(name)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-comment"># if request.method == "GET":</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="hljs-comment">#   pass</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-comment"># if request.method == "PUT":</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-comment">#   pass</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment"># if request.method == "POST"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-comment">#   pass</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                myform = NouveauForm()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-keyword">if</span> myform.validate_on_submit():
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      session[<span class="hljs-string">'name'</span>] = myform.name.data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-comment"># je filtre dans ma db en recherche de user</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              user_retrieved = User.query.filter_by(username=myform.name.data).first()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  print(user_retrieved)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="hljs-keyword">if</span> user_retrieved <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment"># if n'existe pas</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span class="hljs-comment"># je crée une nouvelle instance user</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        user = User(username = myform.name.data)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              db.session.add(user)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    db.session.commit()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span class="hljs-comment"># pour garder en mémoire</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                session[<span class="hljs-string">"connu"</span>] = <span class="hljs-string">"Vous êtes inconnu, on vous ajoute !"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-keyword">else</span>:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          session[<span class="hljs-string">"connu"</span>] = <span class="hljs-string">"Vous êtes connu de la bdd !"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  myform.name.data = <span class="hljs-string">''</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'test'</span>, name=session.get(<span class="hljs-string">'name'</span>)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        contenu_html = <span class="hljs-string">"&lt;h1&gt; Salut toi ;) &lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            dico = OrderedDict({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-string">"tâche1"</span>: <span class="hljs-string">"Faire la vaisselle"</span>,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-string">"tâche2"</span>: <span class="hljs-string">"Faire le ménage"</span>,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-string">"tâche3"</span>: <span class="hljs-string">"écouter Monsieur Bertin"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-comment"># presentation rendered </span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>, var1=name, var2=contenu_html, dico=dico, form=myform, connu=session.get(<span class="hljs-string">"connu"</span>))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-decorator">@app.route("/voiciunredirect/")</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unefonction</span><span class="hljs-params">()</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">"myfonction"</span>)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-decorator">@app.route('/user/&lt;name&gt;')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trouve</span><span class="hljs-params">(name)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span class="hljs-comment"># -----</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;h1&gt;Hello &lt;i&gt;"</span> + name + <span class="hljs-string">"&lt;/i&gt;&lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment">#@app.route('/&lt;path:nompath&gt;')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment"># def test2(nompath):</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-comment">#  return "&lt;h1&gt;Hello&lt;/h1&gt;"</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-decorator">@app.route('/&lt;path:nompath&gt;')</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error_404</span><span class="hljs-params">(nompath)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              abort(<span class="hljs-number">404</span>, <span class="hljs-string">"The page {} is not found"</span>.format(nompath))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-decorator">@app.errorhandler(404)</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_not_found</span><span class="hljs-params">(e)</span>:</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'404.html'</span>, error_message=e), <span class="hljs-number">404</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    manager.run()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </code></pre>